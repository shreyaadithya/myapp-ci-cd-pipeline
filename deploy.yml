#- hosts: webservers
  #become: yes
  #tasks:
    #- name: Stop Tomcat
      #systemd:
        #name: tomcat
        #state: stopped

    #- name: Copy WAR to Tomcat webapps
      #copy:
        #src: target/myapp-1.0.0.war
        #dest: /opt/tomcat/webapps/myapp.war
        #mode: '0644'

    #- name: Start Tomcat
      #systemd:
        #name: tomcat
        #state: started 


---
- name: Deploy myapp WAR to Tomcat
  hosts: target
  become: yes
  vars:
    artifact_url: "{{ artifact_repo }}/{{ artifact_name }}"
    deploy_path: "{{ tomcat_path }}/webapps/myapp.war"
  tasks:
    - name: Download WAR from Artifactory
      get_url:
        url: "{{ artifact_url }}"
        dest: "{{ deploy_path }}"
        mode: '0644'

    - name: Restart Tomcat
      systemd:
        name: tomcat
        state: restarted

    - name: Ensure WAR deployed
      stat:
        path: "{{ tomcat_path }}/webapps/myapp.war"
      register: war_file

    - name: Debug deployment status
      debug:
        msg: "WAR deployment successful!" 
      when: war_file.stat.exists


